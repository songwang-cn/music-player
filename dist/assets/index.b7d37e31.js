var X=Object.defineProperty;var Y=(e,t,a)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var M=(e,t,a)=>(Y(e,typeof t!="symbol"?t+"":t,a),a);import{c as ee,s as B,d as z,r as m,w as T,a as U,b as H,u as f,n as J,e as k,o as u,f as n,g as D,h as g,F as E,i as L,j as F,t as C,p as q,k as R,M as te,l as b,m as O,q as se}from"./index.17d1fa5a.js";class ne{constructor(){M(this,"audio");M(this,"url","");this.audio=new Audio}setUrl(t){return this.audio.src=t,this}getDuration(){return this.audio.currentTime}play(){this.audio.play()}pause(){this.audio.pause()}setCurrentTime(t){return this.audio.currentTime=t,this}}function W(){const e=navigator.userAgent;return{isPc:ee(()=>e.indexOf("Windows")>-1&&e.indexOf("NT")>-1||e.indexOf("Macintosh")>-1)}}const Z="sumBlLtuZ4h4r7DO";class K{constructor(t){M(this,"url","");M(this,"method","GET");this.url=t}setMethod(t){this.method=t}async get(t){this.setMethod("GET"),this.onRequest(t)}async post(t){return this.setMethod("POST"),this.onRequest(t)}async onRequest(t){return B({type:"loading",message:"\u52A0\u8F7D\u4E2D...",duration:2}),(await(await fetch(this.url,{method:this.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({token:Z,...t})})).json()).data}}const N={Music:{Search:"https://v2.alapi.cn/api/music/search",Detail:"https://v2.alapi.cn/api/music/detail",PlayUrl:"https://v2.alapi.cn/api/music/url"}},oe=[{id:1,name:"\u5468\u6770\u4F26"},{id:2,name:"\u6797\u4FCA\u6770"},{id:3,name:"\u738B\u529B\u5B8F"},{id:5,name:"\u9648\u5955\u8FC5"},{id:7,name:"en"},{id:8,name:"\u859B\u4E4B\u8C26"}],ae=e=>(q("data-v-8da9203e"),e=e(),R(),e),ie={class:"pop-panel"},le=ae(()=>n("div",{class:"pop-t"},"\u97F3\u4E50\u641C\u7D22",-1)),ue={class:"content"},ce={key:0,class:"artist"},de=["onClick"],re={key:1,class:"song-list"},pe=["onClick"],ve={class:"left"},me={class:"name"},_e={class:"singer"},he=z({__name:"search",props:{modelValue:{type:Boolean,default:!1}},emits:["onPlay","update:modelValue"],setup(e,{emit:t}){const{isPc:a}=W(),y=e,p=m(y.modelValue);T(()=>y.modelValue,h=>{p.value=h});const l=t;T(()=>p.value,h=>{l("update:modelValue",h)});const c=m(""),o=m([]),d=m(1),$=m(30),_=m(0);async function V(){const h=await new K(N.Music.Search).post({keyword:c.value,page:d.value,limit:$.value});o.value=h.songs,_.value=h.songCount}function j(h){d.value=h,V()}return(h,v)=>{const x=k("van-search"),A=k("van-empty"),P=k("van-pagination"),I=k("van-popup");return u(),U(I,{round:"","overlay-style":{background:"none"},show:p.value,"onUpdate:show":v[2]||(v[2]=r=>p.value=r),position:f(a)?"right":"bottom",style:J({width:f(a)?"40%":"100%",height:f(a)?"100%":"90%",background:"rgba(0,0,0,.7)"})},{default:H(()=>[n("div",ie,[le,n("div",ue,[D(x,{placeholder:"\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22\u6B4C\u66F2",style:{padding:"0"},modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=r=>c.value=r),onSearch:V},null,8,["modelValue"]),c.value?F("",!0):(u(),g("div",ce,[(u(!0),g(E,null,L(f(oe),r=>(u(),g("div",{class:"item",onClick:s=>{c.value=r.name,V()}},C(r.name),9,de))),256))])),o.value.length?(u(),g("div",re,[(u(!0),g(E,null,L(o.value,r=>(u(),g("div",{class:"item",onClick:s=>l("onPlay",r)},[n("div",ve,[n("div",me,C(r.name),1)]),n("div",_e,C(r.artists.map(s=>s.name).join(",")),1)],8,pe))),256))])):(u(),U(A,{key:2,style:{flex:"1"},description:"\u7A7A\u7A7A\u5982\u4E5F"})),o.value.length?(u(),U(P,{key:3,mode:"simple","items-per-page":$.value,modelValue:d.value,"onUpdate:modelValue":v[1]||(v[1]=r=>d.value=r),"total-items":_.value,onChange:j},null,8,["items-per-page","modelValue","total-items"])):F("",!0)])])]),_:1},8,["show","position","style"])}}});const G=(e,t)=>{const a=e.__vccOpts||e;for(const[y,p]of t)a[y]=p;return a},ge=G(he,[["__scopeId","data-v-8da9203e"]]),ye=e=>(q("data-v-849dadfe"),e=e(),R(),e),fe={class:"pop-panel"},Ce=ye(()=>n("div",{class:"pop-t"},"\u64AD\u653E\u5217\u8868",-1)),ke={class:"content"},we={key:0,class:"song-list"},$e=["onClick"],Ve={class:"left"},be={class:"name"},xe={key:0,class:"iconfont icon-zhengzaibofang"},Ae={class:"singer"},Pe=z({__name:"historyList",props:{modelValue:{type:Boolean,default:!1},musicObj:{type:Object,default:()=>new te},isPlaying:{type:Boolean,default:!1}},emits:["onPlay","update:modelValue"],setup(e,{emit:t}){const{isPc:a}=W(),y=e,p=m(y.modelValue);T(()=>y.modelValue,c=>{p.value=c});const l=t;return T(()=>p.value,c=>{l("update:modelValue",c)}),(c,o)=>{const d=k("van-empty"),$=k("van-popup");return u(),U($,{"overlay-style":{background:"none"},round:"",show:p.value,"onUpdate:show":o[0]||(o[0]=_=>p.value=_),position:f(a)?"left":"bottom",style:J({width:f(a)?"40%":"100%",height:f(a)?"100%":"90%",background:"rgba(0,0,0,.7)"})},{default:H(()=>[n("div",fe,[Ce,n("div",ke,[f(b)().historyMusicList.length?(u(),g("div",we,[(u(!0),g(E,null,L(f(b)().historyMusicList,_=>(u(),g("div",{class:O(["item",e.musicObj.id==_.id&&"current"]),onClick:V=>l("onPlay",_)},[n("div",Ve,[n("div",be,[e.musicObj.id==_.id&&e.isPlaying?(u(),g("i",xe)):F("",!0),se(" "+C(_.name),1)])]),n("div",Ae,C(_.singer),1)],10,$e))),256))])):(u(),U(d,{key:1,style:{flex:"1"},description:"\u7A7A\u7A7A\u5982\u4E5F"}))])])]),_:1},8,["show","position","style"])}}});const Se=G(Pe,[["__scopeId","data-v-849dadfe"]]),Me=e=>(q("data-v-eb8ab4f9"),e=e(),R(),e),De={class:"music"},Ue={class:"music-content"},Ie={class:"music-top"},Oe=Me(()=>n("div",{class:"mask"},null,-1)),Te={class:"ctl"},je={class:"song-name"},Be={class:"progress"},Ee={class:"time"},Le={class:"time"},Fe={class:"act"},Ne=z({__name:"index",setup(e){const t=m(!1),a=m(!1);function y(){t.value=!0}function p(){a.value=!0}const l=m(!1),c=m(0),o=m(b().lastMusicObj);console.log(o.value);const d=new ne().setUrl(o.value.url);function $(s){P(),d.setCurrentTime(s/100*o.value.dt/1e3),A()}function _(){l.value=!l.value,l.value?(d.play(),A()):(d.pause(),P())}function V(){l.value=!1;const s=b().historyMusicList;if(!s.length)return B("\u64AD\u653E\u5217\u8868\u4E3A\u7A7A");const i=s.findIndex(w=>w.id===o.value.id);v(i===0?s[s.length-1]:s[i-1])}function j(){l.value=!1;const s=b().historyMusicList;if(!s.length)return B("\u64AD\u653E\u5217\u8868\u4E3A\u7A7A");const i=s.findIndex(w=>w.id===o.value.id);i<s.length-1?v(s[i+1]):v(s[0])}async function h(s){const i=await new K(N.Music.Detail).post({id:s.id});o.value.setName(i.songs[0].name).setCoverUrl(i.songs[0].al.picUrl).setDuration(i.songs[0].dt).setSinger(i.songs[0].ar.map(w=>w.name).join(","))}async function v(s){await h(s);const i=`${N.Music.PlayUrl}?id=${s.id}&token=${Z}`;o.value.setId(s.id).setUrl(i),d.setUrl(i).play(),b().setLastMusicObj(o.value),l.value=!0,A()}const x=m(null);function A(){P(),x.value=setInterval(()=>{console.log(d.getDuration(),o.value.dt),c.value=d.getDuration()*1e3/o.value.dt*100,console.log(c.value)},1e3)}function P(){clearInterval(x.value),x.value=null}function I(s){return`${Math.floor(s/60)}:${r(Math.ceil(s%60))}`}function r(s){return s>=10?s:"0"+s}return(s,i)=>{const w=k("van-image"),Q=k("van-slider");return u(),g("div",De,[n("div",Ue,[n("div",{class:"top-bar"},[n("i",{class:"iconfont icon-lishixiao",onClick:p}),n("i",{class:"iconfont icon-sousuo",onClick:y})]),n("div",Ie,[n("div",{class:O(["music-pic",l.value&&"playing"])},[D(w,{class:O([l.value?"playing":"pause","music_img"]),src:o.value.coverUrl,width:"65%",height:"65%"},null,8,["class","src"]),Oe],2)]),n("div",Te,[n("div",je,C(o.value.name)+"\xA0-\xA0"+C(o.value.singer),1),n("div",Be,[n("div",Ee,C(I(f(d).getDuration())),1),D(Q,{modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=S=>c.value=S),onChange:$},null,8,["modelValue"]),n("div",Le,C(I(o.value.dt/1e3)),1)]),n("div",Fe,[n("i",{class:"music-ctrl iconfont icon-shixin-shangyishou",onClick:V}),n("i",{class:O(["music-ctrl iconfont",l.value?"icon-zanting":"icon-zantingbofang"]),onClick:_},null,2),n("i",{class:"music-ctrl iconfont icon-shixin-shangyishou",onClick:j,style:{transform:"rotate(180deg)"}})])])]),D(ge,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=S=>t.value=S),onOnPlay:v},null,8,["modelValue"]),D(Se,{modelValue:a.value,"onUpdate:modelValue":i[2]||(i[2]=S=>a.value=S),"music-obj":o.value,onOnPlay:v,"is-playing":l.value},null,8,["modelValue","music-obj","is-playing"])])}}});const Re=G(Ne,[["__scopeId","data-v-eb8ab4f9"]]);export{Re as default};
