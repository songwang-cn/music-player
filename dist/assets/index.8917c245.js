var se=Object.defineProperty;var ne=(n,t,a)=>t in n?se(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var P=(n,t,a)=>(ne(n,typeof t!="symbol"?t+"":t,a),a);import{c as oe,s as b,d as H,r as m,w as M,a as F,b as Q,u as y,n as G,e as x,o as c,f as s,g as E,h,F as L,i as N,j as z,t as w,k as R,p as J,l as W,M as X,m as f,q as U,v as ae,x as ie}from"./index.e008f40d.js";class ue{constructor(){P(this,"audio");P(this,"url","");this.audio=new Audio}setUrl(t){return this.audio.src=t,this}getDuration(){return this.audio.currentTime}play(){this.audio.play()}pause(){this.audio.pause()}setCurrentTime(t){return this.audio.currentTime=t,this}onEnded(t){this.audio.onended=t}}function Y(){const n=navigator.userAgent;return{isPc:oe(()=>n.indexOf("Windows")>-1&&n.indexOf("NT")>-1||n.indexOf("Macintosh")>-1)}}const ee="sumBlLtuZ4h4r7DO";class te{constructor(t){P(this,"url","");P(this,"method","GET");this.url=t}setMethod(t){this.method=t}async get(t){this.setMethod("GET"),this.onRequest(t)}async post(t){return this.setMethod("POST"),this.onRequest(t)}async onRequest(t){return b({type:"loading",message:"\u52A0\u8F7D\u4E2D...",duration:2}),(await(await fetch(this.url,{method:this.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({token:ee,...t})})).json()).data}}const q={Music:{Search:"https://v2.alapi.cn/api/music/search",Detail:"https://v2.alapi.cn/api/music/detail",PlayUrl:"https://v2.alapi.cn/api/music/url"}},le=[{id:1,name:"\u5468\u6770\u4F26"},{id:2,name:"\u6797\u4FCA\u6770"},{id:3,name:"\u738B\u529B\u5B8F"},{id:5,name:"\u9648\u5955\u8FC5"},{id:7,name:"en"},{id:8,name:"\u859B\u4E4B\u8C26"}],ce=n=>(J("data-v-16c57568"),n=n(),W(),n),de={class:"pop-panel"},re=ce(()=>s("div",{class:"pop-t"},"\u97F3\u4E50\u641C\u7D22",-1)),pe={class:"content"},ve={key:0,class:"artist"},me=["onClick"],_e={key:1,class:"song-list"},he=["onClick"],ye={class:"left"},fe={class:"name"},ge={class:"action"},Ce=["onClick"],be=["onClick"],we=H({__name:"search",props:{modelValue:{type:Boolean,default:!1}},emits:["onPlay","update:modelValue"],setup(n,{emit:t}){const{isPc:a}=Y(),p=n,d=m(p.modelValue);M(()=>p.modelValue,u=>{d.value=u});const l=t;M(()=>d.value,u=>{l("update:modelValue",u)});async function A(u){const _=new X().setId(u.id).setName(u.name).setDuration(u.duration).setSinger(u.artists.map($=>$.name).join(","));f().addMusicToHistory(_),b({type:"success",message:"\u5DF2\u6DFB\u52A0\u5230\u64AD\u653E\u5217\u8868"})}const o=m(""),r=m([]),k=m(1),B=m(30),v=m(0);async function C(){const u=await new te(q.Music.Search).post({keyword:o.value,page:k.value,limit:B.value});r.value=u.songs,v.value=u.songCount}function I(u){k.value=u,C()}return(u,_)=>{const $=x("van-search"),V=x("van-empty"),S=x("van-pagination"),T=x("van-popup");return c(),F(T,{round:"","overlay-style":{background:"none"},show:d.value,"onUpdate:show":_[2]||(_[2]=e=>d.value=e),position:y(a)?"right":"bottom",style:G({width:y(a)?"40%":"100%",height:y(a)?"100%":"90%"})},{default:Q(()=>[s("div",de,[re,s("div",pe,[E($,{placeholder:"\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22\u6B4C\u66F2",style:{padding:"0"},modelValue:o.value,"onUpdate:modelValue":_[0]||(_[0]=e=>o.value=e),onSearch:C},null,8,["modelValue"]),o.value?z("",!0):(c(),h("div",ve,[(c(!0),h(L,null,N(y(le),e=>(c(),h("div",{class:"item",onClick:i=>{o.value=e.name,C()}},w(e.name),9,me))),256))])),r.value.length?(c(),h("div",_e,[(c(!0),h(L,null,N(r.value,e=>(c(),h("div",{class:"item",onClick:i=>{l("onPlay",e),d.value=!1}},[s("div",ye,[s("div",fe,w(e.name)+"\xA0\xA0\xA0 "+w(e.artists.map(i=>i.name).join(",")),1)]),s("div",ge,[s("i",{onClick:R(i=>{l("onPlay",e),d.value=!1},["stop"]),class:"iconfont icon-bofang"},null,8,Ce),s("i",{onClick:R(i=>A(e),["stop"]),class:"iconfont icon-tianjiadingdan1"},null,8,be)])],8,he))),256))])):(c(),F(V,{key:2,style:{flex:"1"},description:"\u7A7A\u7A7A\u5982\u4E5F"})),r.value.length?(c(),F(S,{key:3,mode:"simple","items-per-page":B.value,modelValue:k.value,"onUpdate:modelValue":_[1]||(_[1]=e=>k.value=e),"total-items":v.value,onChange:I},null,8,["items-per-page","modelValue","total-items"])):z("",!0)])])]),_:1},8,["show","position","style"])}}});const Z=(n,t)=>{const a=n.__vccOpts||n;for(const[p,d]of t)a[p]=d;return a},ke=Z(we,[["__scopeId","data-v-16c57568"]]),xe=n=>(J("data-v-a9e5345b"),n=n(),W(),n),Ae={class:"pop-panel"},$e=xe(()=>s("div",{class:"pop-t"}," \u64AD\u653E\u5217\u8868 ",-1)),De={class:"content"},Be={key:0,class:"song-list"},Ve=["onClick"],Pe={class:"left"},Ee={class:"name"},Fe={key:0,class:"iconfont icon-zhengzaibofang"},Se={class:"action"},Ue=["onClick"],Me=H({__name:"historyList",props:{modelValue:{type:Boolean,default:!1},musicObj:{type:Object,default:()=>new X},isPlaying:{type:Boolean,default:!1}},emits:["onPlay","onNext","update:modelValue"],setup(n,{emit:t}){const{isPc:a}=Y(),p=n,d=m(p.modelValue);M(()=>p.modelValue,o=>{d.value=o});const l=t;M(()=>d.value,o=>{l("update:modelValue",o)});function A(o){o.id===p.musicObj.id&&l("onNext"),f().deleteInHistory(o)}return(o,r)=>{const k=x("van-empty"),B=x("van-popup");return c(),F(B,{"overlay-style":{background:"none"},round:"",show:d.value,"onUpdate:show":r[0]||(r[0]=v=>d.value=v),position:y(a)?"left":"bottom",style:G({width:y(a)?"400px":"100%",height:"88%",background:"rgba(0,0,0,.7)"})},{default:Q(()=>[s("div",Ae,[$e,s("div",De,[y(f)().historyMusicList.length?(c(),h("div",Be,[(c(!0),h(L,null,N(y(f)().historyMusicList,v=>(c(),h("div",{class:U(["item",n.musicObj.id==v.id&&"current"]),onClick:C=>l("onPlay",v)},[s("div",Pe,[s("div",Ee,[n.musicObj.id==v.id&&n.isPlaying?(c(),h("i",Fe)):z("",!0),ae(" "+w(v.name)+"\xA0\xA0"+w(v.singer),1)])]),s("div",Se,[s("i",{class:"iconfont icon-shanchu1",onClick:R(C=>A(v),["stop"])},null,8,Ue)])],10,Ve))),256))])):(c(),F(k,{key:1,style:{flex:"1"},description:"\u7A7A\u7A7A\u5982\u4E5F"}))])])]),_:1},8,["show","position","style"])}}});const je=Z(Me,[["__scopeId","data-v-a9e5345b"]]);async function K(){b({type:"loading",message:"\u58C1\u7EB8\u52A0\u8F7D\u4E2D",forbidClick:!0,duration:0});const t=await(await fetch("https://api.wetab.link/api/wallpaper/next?type=random")).json(),a=document.createElement("img");return a.src=t.data.rawSrc,new Promise(p=>{a.onload=()=>{f().setBgUrl(t.data.rawSrc),p(t.data.rawSrc),b().close(),ie(()=>{b({message:"\u58C1\u7EB8\u52A0\u8F7D\u6210\u529F",type:"success"})})},a.onerror=()=>{f().setBgUrl(new URL(""+new URL("bg.3e0d6b15.webp",import.meta.url).href,self.location).href)}})}const j=n=>(J("data-v-61072bfb"),n=n(),W(),n),Ie={class:"music-content"},Te={class:"top-bar"},Oe=j(()=>s("div",{class:"bar-t"},"\u5217\u8868",-1)),Le={class:"bar-item"},Ne=j(()=>s("div",{class:"bar-t"},"\u80CC\u666F",-1)),ze=j(()=>s("div",{class:"bar-t"},"\u641C\u7D22",-1)),Re=j(()=>s("div",{class:"mask"},null,-1)),qe={class:"ctl"},He={class:"song-name"},Ge={class:"progress"},Je={class:"time"},We={class:"time"},Ze={class:"act"},Ke=H({__name:"index",setup(n){const t=m(!1),a=m(!1);function p(){t.value=!0}function d(){a.value=!0}const l=m(!1),A=m(0),o=m(f().lastMusicObj);console.log(o.value);const r=new ue().setUrl(o.value.url);r.onEnded(()=>{console.log("\u5F53\u524D\u6B4C\u66F2\u64AD\u653E\u5B8C\u6BD5"),setTimeout(()=>{C()},1e3)});function k(e){V(),r.setCurrentTime(e/100*o.value.dt/1e3),$()}function B(){if(!o.value.url)return b("\u6682\u65E0\u97F3\u4E50\uFF0C\u70B9\u51FB\u53F3\u4E0A\u89D2\u53BB\u641C\u7D22\u6B4C\u66F2");l.value=!l.value,l.value?(r.play(),$()):(r.pause(),V())}function v(){l.value=!1;const e=f().historyMusicList;if(!e.length)return b("\u64AD\u653E\u5217\u8868\u4E3A\u7A7A");const i=e.findIndex(g=>g.id===o.value.id);u(i===0?e[e.length-1]:e[i-1])}function C(){l.value=!1;const e=f().historyMusicList;if(!e.length)return b("\u64AD\u653E\u5217\u8868\u4E3A\u7A7A");const i=e.findIndex(g=>g.id===o.value.id);i<e.length-1?u(e[i+1]):u(e[0])}async function I(e){const g=(await new te(q.Music.Detail).post({id:e.id})).songs[0];o.value.setName(g.name).setCoverUrl(g.al.picUrl).setDuration(g.dt).setSinger(g.ar.map(O=>O.name).join(","))}async function u(e){if(e.id===o.value.id&&l.value)return b("\u6B63\u5728\u64AD\u653E");await I(e);const i=`${q.Music.PlayUrl}?id=${e.id}&token=${ee}`;o.value.setId(e.id).setUrl(i),r.setUrl(i).play(),f().setLastMusicObj(o.value),l.value=!0,$()}const _=m(null);function $(){V(),_.value=setInterval(()=>{A.value=r.getDuration()*1e3/o.value.dt*100},1e3)}function V(){clearInterval(_.value),_.value=null}function S(e){return`${Math.floor(e/60)}:${T(Math.ceil(e%60))}`}function T(e){return e>=10?e:"0"+e}return(e,i)=>{const g=x("van-image"),O=x("van-slider");return c(),h("div",{class:"music",style:G({backgroundImage:`url(${y(f)().bgUrl})`})},[s("div",Ie,[s("div",Te,[s("div",{class:"bar-item"},[s("div",{class:"iconfont icon-liebiao",onClick:d}),Oe]),s("div",Le,[s("i",{class:"iconfont icon-dongtaibizhi",onClick:i[0]||(i[0]=(...D)=>y(K)&&y(K)(...D))}),Ne]),s("div",{class:"bar-item"},[s("i",{class:"iconfont icon-sousuo",onClick:p}),ze])]),(c(),h("div",{class:"music-top",key:o.value.id},[s("div",{class:U(["music-pic",l.value&&"playing"])},[E(g,{class:U([l.value?"playing":"pause","music_img"]),src:o.value.coverUrl,width:"65%",height:"65%"},null,8,["class","src"]),Re],2)])),s("div",qe,[s("div",He,w(o.value.name)+"\xA0-\xA0"+w(o.value.singer),1),s("div",Ge,[s("div",Je,w(S(y(r).getDuration())),1),E(O,{modelValue:A.value,"onUpdate:modelValue":i[1]||(i[1]=D=>A.value=D),onChange:k},null,8,["modelValue"]),s("div",We,w(S(o.value.dt/1e3)),1)]),s("div",Ze,[s("i",{class:"music-ctrl iconfont icon-shixin-shangyishou",onClick:v}),s("i",{class:U(["music-ctrl iconfont",l.value?"icon-zanting":"icon-zantingbofang"]),onClick:B},null,2),s("i",{class:"music-ctrl iconfont icon-shixin-shangyishou",onClick:C,style:{transform:"rotate(180deg)"}})])])]),E(ke,{modelValue:t.value,"onUpdate:modelValue":i[2]||(i[2]=D=>t.value=D),onOnPlay:u},null,8,["modelValue"]),E(je,{modelValue:a.value,"onUpdate:modelValue":i[3]||(i[3]=D=>a.value=D),"music-obj":o.value,onOnPlay:u,onOnNext:C,"is-playing":l.value},null,8,["modelValue","music-obj","is-playing"])],4)}}});const Ye=Z(Ke,[["__scopeId","data-v-61072bfb"]]);export{Ye as default};
