var se=Object.defineProperty;var ne=(s,e,i)=>e in s?se(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i;var P=(s,e,i)=>(ne(s,typeof e!="symbol"?e+"":e,i),i);import{c as oe,s as C,t as X,a as v,d as H,r as h,w as j,b as I,e as Y,u as g,n as G,f as D,o as c,g as t,h as S,i as f,F as L,j as N,k as z,l as k,m as R,p as J,q as W,M as Z,v as M,x as ae,y as ie}from"./index.f722bc3e.js";class ue{constructor(){P(this,"audio");P(this,"url","");this.audio=new Audio}setUrl(e){return this.audio.src=e,this}getDuration(){return this.audio.currentTime}play(){this.audio.play()}pause(){this.audio.pause()}setCurrentTime(e){return this.audio.currentTime=e,this}onEnded(e){this.audio.onended=e}}function ee(){const s=navigator.userAgent;return{isPc:oe(()=>s.indexOf("Windows")>-1&&s.indexOf("NT")>-1||s.indexOf("Macintosh")>-1)}}class te{constructor(e){P(this,"url","");P(this,"method","GET");this.url=e}setMethod(e){this.method=e}async get(e){return this.setMethod("GET"),this.onRequest(e)}async post(e){return this.setMethod("POST"),this.onRequest(e)}async onRequest(e){C({type:"loading",message:"\u52A0\u8F7D\u4E2D...",duration:2});const i=await fetch(this.url,{method:this.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({token:X[v().tokenIndex],...e})});return v().changeTokenIndex(),(await i.json()).data}}const q={Music:{Search:"https://v2.alapi.cn/api/music/search",Detail:"https://v2.alapi.cn/api/music/detail",PlayUrl:"https://v2.alapi.cn/api/music/url"}},le=[{id:1,name:"\u5468\u6770\u4F26"},{id:2,name:"\u6797\u4FCA\u6770"},{id:3,name:"\u738B\u529B\u5B8F"},{id:5,name:"\u9648\u5955\u8FC5"},{id:7,name:"en"},{id:8,name:"\u859B\u4E4B\u8C26"}],ce=s=>(J("data-v-92fe8377"),s=s(),W(),s),de={class:"pop-panel"},re=ce(()=>t("div",{class:"pop-t"},"\u97F3\u4E50\u641C\u7D22",-1)),pe={class:"content"},ve={key:0,class:"artist"},me=["onClick"],_e={key:1,class:"song-list"},he=["onClick"],ye={class:"left"},fe={class:"name"},ge={class:"action"},Ce=["onClick"],ke=["onClick"],we=H({__name:"search",props:{modelValue:{type:Boolean,default:!1}},emits:["onPlay","update:modelValue"],setup(s,{emit:e}){const{isPc:i}=ee(),m=s,p=h(m.modelValue);j(()=>m.modelValue,u=>{p.value=u});const l=e;j(()=>p.value,u=>{l("update:modelValue",u)});function w(u){l("onPlay",u),p.value=!1}async function a(u){const y=new Z().setId(u.id).setName(u.name).setDuration(u.duration).setSinger(u.artists.map(B=>B.name).join(","));v().addMusicToHistory(y),C({type:"success",message:"\u5DF2\u6DFB\u52A0\u5230\u64AD\u653E\u5217\u8868"})}const d=h(""),x=h([]),b=h(1),_=h(30),A=h(0);async function F(){const u=await new te(q.Music.Search).post({keyword:d.value,page:b.value,limit:_.value});x.value=u.songs,A.value=u.songCount}function $(u){b.value=u,F()}return(u,y)=>{const B=D("van-search"),U=D("van-empty"),T=D("van-pagination"),o=D("van-popup");return c(),I(o,{round:"","overlay-style":{background:"none"},show:p.value,"onUpdate:show":y[2]||(y[2]=n=>p.value=n),position:g(i)?"right":"bottom",style:G({width:g(i)?"40%":"100%",height:g(i)?"100%":"90%"})},{default:Y(()=>[t("div",de,[re,t("div",pe,[S(B,{placeholder:"\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22\u6B4C\u66F2",style:{padding:"0"},modelValue:d.value,"onUpdate:modelValue":y[0]||(y[0]=n=>d.value=n),onSearch:F},null,8,["modelValue"]),d.value?z("",!0):(c(),f("div",ve,[(c(!0),f(L,null,N(g(le),n=>(c(),f("div",{class:"item",onClick:r=>{d.value=n.name,F()}},k(n.name),9,me))),256))])),x.value.length?(c(),f("div",_e,[(c(!0),f(L,null,N(x.value,n=>(c(),f("div",{class:"item",onClick:r=>w(n)},[t("div",ye,[t("div",fe,k(n.name)+"\xA0\xA0\xA0 "+k(n.artists.map(r=>r.name).join(",")),1)]),t("div",ge,[t("i",{onClick:R(r=>w(n),["stop"]),class:"iconfont icon-bofang"},null,8,Ce),t("i",{onClick:R(r=>a(n),["stop"]),class:"iconfont icon-tianjiadingdan1"},null,8,ke)])],8,he))),256))])):(c(),I(U,{key:2,style:{flex:"1"},description:"\u7A7A\u7A7A\u5982\u4E5F"})),x.value.length?(c(),I(T,{key:3,mode:"simple","items-per-page":_.value,modelValue:b.value,"onUpdate:modelValue":y[1]||(y[1]=n=>b.value=n),"total-items":A.value,onChange:$},null,8,["items-per-page","modelValue","total-items"])):z("",!0)])])]),_:1},8,["show","position","style"])}}});const K=(s,e)=>{const i=s.__vccOpts||s;for(const[m,p]of e)i[m]=p;return i},xe=K(we,[["__scopeId","data-v-92fe8377"]]),be=s=>(J("data-v-a9e5345b"),s=s(),W(),s),Ae={class:"pop-panel"},$e=be(()=>t("div",{class:"pop-t"}," \u64AD\u653E\u5217\u8868 ",-1)),De={class:"content"},Be={key:0,class:"song-list"},Ve=["onClick"],Ee={class:"left"},Fe={class:"name"},Pe={key:0,class:"iconfont icon-zhengzaibofang"},Se={class:"action"},Ie=["onClick"],Ue=H({__name:"historyList",props:{modelValue:{type:Boolean,default:!1},musicObj:{type:Object,default:()=>new Z},isPlaying:{type:Boolean,default:!1}},emits:["onPlay","onNext","update:modelValue"],setup(s,{emit:e}){const{isPc:i}=ee(),m=s,p=h(m.modelValue);j(()=>m.modelValue,a=>{p.value=a});const l=e;j(()=>p.value,a=>{l("update:modelValue",a)});function w(a){a.id===m.musicObj.id&&l("onNext"),v().deleteInHistory(a)}return(a,d)=>{const x=D("van-empty"),b=D("van-popup");return c(),I(b,{"overlay-style":{background:"none"},round:"",show:p.value,"onUpdate:show":d[0]||(d[0]=_=>p.value=_),position:g(i)?"left":"bottom",style:G({width:g(i)?"400px":"100%",height:"88%",background:"rgba(0,0,0,.7)"})},{default:Y(()=>[t("div",Ae,[$e,t("div",De,[g(v)().historyMusicList.length?(c(),f("div",Be,[(c(!0),f(L,null,N(g(v)().historyMusicList,_=>(c(),f("div",{class:M(["item",s.musicObj.id==_.id&&"current"]),onClick:A=>l("onPlay",_)},[t("div",Ee,[t("div",Fe,[s.musicObj.id==_.id&&s.isPlaying?(c(),f("i",Pe)):z("",!0),ae(" "+k(_.name)+"\xA0\xA0"+k(_.singer),1)])]),t("div",Se,[t("i",{class:"iconfont icon-shanchu1",onClick:R(A=>w(_),["stop"])},null,8,Ie)])],10,Ve))),256))])):(c(),I(x,{key:1,style:{flex:"1"},description:"\u7A7A\u7A7A\u5982\u4E5F"}))])])]),_:1},8,["show","position","style"])}}});const Me=K(Ue,[["__scopeId","data-v-a9e5345b"]]);async function Q(){C({type:"loading",message:"\u58C1\u7EB8\u52A0\u8F7D\u4E2D",forbidClick:!0,duration:0});const e=await(await fetch("https://api.wetab.link/api/wallpaper/next?type=random")).json(),i=document.createElement("img");return i.src=e.data.rawSrc,new Promise(m=>{i.onload=()=>{v().setBgUrl(e.data.rawSrc),m(e.data.rawSrc),C().close(),ie(()=>{C({message:"\u58C1\u7EB8\u52A0\u8F7D\u6210\u529F",type:"success"})})},i.onerror=()=>{v().setBgUrl(new URL(""+new URL("bg.3e0d6b15.webp",import.meta.url).href,self.location).href)}})}const E=s=>(J("data-v-642c41cf"),s=s(),W(),s),je={class:"music-content"},Te={class:"top-bar"},Oe=E(()=>t("div",{class:"iconfont icon-liebiao"},null,-1)),Le=E(()=>t("div",{class:"bar-t"},"\u64AD\u653E\u5217\u8868",-1)),Ne=[Oe,Le],ze=E(()=>t("i",{class:"iconfont icon-dongtaibizhi"},null,-1)),Re=E(()=>t("div",{class:"bar-t"},"\u968F\u673A\u80CC\u666F",-1)),qe=[ze,Re],He=E(()=>t("i",{class:"iconfont icon-sousuo"},null,-1)),Ge=E(()=>t("div",{class:"bar-t"},"\u6B4C\u66F2\u641C\u7D22",-1)),Je=[He,Ge],We=E(()=>t("div",{class:"mask"},null,-1)),Ke={class:"ctl"},Qe={class:"song-name"},Xe={class:"progress"},Ye={class:"time"},Ze={class:"time"},et={class:"act"},tt=H({__name:"index",setup(s){const e=h(!1),i=h(!1);function m(){e.value=!0}function p(){i.value=!0}const l=h(!1),w=h(0),a=h(v().lastMusicObj);console.log(a.value);const d=new ue().setUrl(a.value.url);d.onEnded(()=>{console.log("\u5F53\u524D\u6B4C\u66F2\u64AD\u653E\u5B8C\u6BD5"),setTimeout(()=>{A()},1e3)});function x(o){B(),d.setCurrentTime(o/100*a.value.dt/1e3),y()}function b(){if(!a.value.url)return C("\u6682\u65E0\u97F3\u4E50\uFF0C\u70B9\u51FB\u53F3\u4E0A\u89D2\u53BB\u641C\u7D22\u6B4C\u66F2");l.value=!l.value,l.value?(d.play(),y()):(d.pause(),B())}function _(){l.value=!1;const o=v().historyMusicList;if(!o.length)return C("\u64AD\u653E\u5217\u8868\u4E3A\u7A7A");const n=o.findIndex(r=>r.id===a.value.id);$(n===0?o[o.length-1]:o[n-1])}function A(){l.value=!1;const o=v().historyMusicList;if(!o.length)return C("\u64AD\u653E\u5217\u8868\u4E3A\u7A7A");const n=o.findIndex(r=>r.id===a.value.id);n<o.length-1?$(o[n+1]):$(o[0])}async function F(o){const r=(await new te(q.Music.Detail).post({id:o.id})).songs[0];a.value.setName(r.name).setCoverUrl(r.al.picUrl).setDuration(r.dt).setSinger(r.ar.map(O=>O.name).join(","))}async function $(o){if(o.id===a.value.id&&l.value)return C("\u6B63\u5728\u64AD\u653E");await F(o);const n=`${q.Music.PlayUrl}?id=${o.id}&token=${X[v().tokenIndex]}`;a.value.setId(o.id).setUrl(n),d.setUrl(n).play(),v().setLastMusicObj(a.value),l.value=!0,y()}const u=h(null);function y(){B(),u.value=setInterval(()=>{w.value=d.getDuration()*1e3/a.value.dt*100},1e3)}function B(){clearInterval(u.value),u.value=null}function U(o){return`${Math.floor(o/60)}:${T(Math.ceil(o%60))}`}function T(o){return o>=10?o:"0"+o}return(o,n)=>{const r=D("van-image"),O=D("van-slider");return c(),f("div",{class:"music",style:G({backgroundImage:`url(${g(v)().bgUrl})`})},[t("div",je,[t("div",Te,[t("div",{class:"bar-item",onClick:p},Ne),t("div",{class:"bar-item",onClick:n[0]||(n[0]=(...V)=>g(Q)&&g(Q)(...V))},qe),t("div",{class:"bar-item",onClick:m},Je)]),(c(),f("div",{class:"music-top",key:a.value.id},[t("div",{class:M(["music-pic",l.value&&"playing"])},[S(r,{class:M([l.value?"playing":"pause","music_img"]),src:a.value.coverUrl,width:"65%",height:"65%"},null,8,["class","src"]),We],2)])),t("div",Ke,[t("div",Qe,k(a.value.name)+"\xA0-\xA0"+k(a.value.singer),1),t("div",Xe,[t("div",Ye,k(U(g(d).getDuration())),1),S(O,{modelValue:w.value,"onUpdate:modelValue":n[1]||(n[1]=V=>w.value=V),onChange:x},null,8,["modelValue"]),t("div",Ze,k(U(a.value.dt/1e3)),1)]),t("div",et,[t("i",{class:"music-ctrl iconfont icon-shixin-shangyishou",onClick:_}),t("i",{class:M(["music-ctrl iconfont",l.value?"icon-zanting":"icon-zantingbofang"]),onClick:b},null,2),t("i",{class:"music-ctrl iconfont icon-shixin-shangyishou",onClick:A,style:{transform:"rotate(180deg)"}})])])]),S(xe,{modelValue:e.value,"onUpdate:modelValue":n[2]||(n[2]=V=>e.value=V),onOnPlay:$},null,8,["modelValue"]),S(Me,{modelValue:i.value,"onUpdate:modelValue":n[3]||(n[3]=V=>i.value=V),"music-obj":a.value,onOnPlay:$,onOnNext:A,"is-playing":l.value},null,8,["modelValue","music-obj","is-playing"])],4)}}});const ot=K(tt,[["__scopeId","data-v-642c41cf"]]);export{ot as default};
